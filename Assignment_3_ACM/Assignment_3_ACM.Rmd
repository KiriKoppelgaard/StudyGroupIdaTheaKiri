---
title: "Assignment_3_ACM"
output: html_document
date: '2022-03-30'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
#load packages and data
library(pacman)
p_load(tidyverse, here, posterior, cmdstanr, boot, brms)

data <- read.csv("data/sc_schizophrenia.csv")


```


```{r}
data <- data %>%
  mutate(Change = FirstRating - SecondRating) %>%
  mutate(Group = ifelse(ID >200, "C", "S")) %>%
  mutate(Feedback = FirstRating - OtherRating)
data <- na.omit(data)

mean(data$Change[data$Group== "S"])
mean(data$Change[data$Group== "C"])

ggplot(data, aes(x=Group, y=Feedback)) + geom_bar(stat = "summary", fun.y = "mean")

ggplot(data, aes(x=Feedback, y=Change,fill="red")) +
  geom_jitter(alpha=0.1) +
  facet_wrap(~ Group) + 
  geom_bar(stat = "summary", fun.y = "mean") +
  theme_bw()

#given first rating the feedback i recieved !!


```



```{r}
file_simple <- file.path("")
file_w <- file.path("")

mod


```


```{r}
#IDA'S CHUNK
data$self_change <- data$FirstRating - data$SecondRating #change from first to second rating
data$self_change_abs <- abs(data$change)
data$feedback <- data$FirstRating -data$OtherRating #FEEDBACK
data$Group <- ifelse(data$ID >200, 0, 1) #control if above 200, schizo if below

data$Group <- as.factor(data$Group)

#remove NAs
data <- na.omit(data) #OBS: check if participants have been removed fully even if only some NAs...


#PLOT EXPLORATION

#positive correlation. But individual differences:
ggplot(data, aes(x=change, y= feedback, col=Group)) +
  geom_point() +
  facet_wrap(~ID)


#also shows something:
ggplot(data, aes(x=FirstRating, y= feedback, col=Group)) +
  geom_point() +
  facet_wrap(~ID)

```



---NOTES FROM CLASS

change ~ feedback
, so:
2rating ~ logit(1rating) + logit(otherrating)

^^ but this has issues!:

BUT BIAS/POTENTIAL CONFOUND: not all feedbacks are possible! (e.g. if rate 8, can only get negative (or 0) feedback)
- reg to the mean? -> how to discriminate btw going down from an 8 rating due to reg to mean, or due to conformity?


SECOND POINT:
prev model was Bernoulli, 0 or 1
But now we need to change the family/shape of the outcome
recommended for assignment:
- go with normal distribution (not unproblematic, since it's discrete data... but for now, fuck it).
- a function of mu (mean expected outcome) and sigma (not part of the model).
mu is logit(first rating) + logit(peerrating). deterministic in simple Bayes, just one value.
Stan doesn't like sigma of 0...
We should put sigma in as a parameter to be estimated! It's the avg error the model is making when predicting the data!
So the parameters (parameters to be estimated) AND model (form of the model) part of stan have to be filled. A model that actually estimates sigma.

we should not have fixed parameters = TRUE, since sigma isn't fixed






BIASES:
- ID plots also show: people differ in how much they use the rating scale





